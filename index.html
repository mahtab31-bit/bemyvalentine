<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Love Quest: Maqbool's Mission</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    
    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        love: {
                            50: '#fff0f3',
                            100: '#ffe3e8',
                            200: '#ffc9d2',
                            300: '#ffa1b0',
                            400: '#ff6b86',
                            500: '#fa3e61',
                            600: '#e61e45',
                            800: '#be1237',
                        }
                    },
                    fontFamily: {
                        script: ['"Great Vibes"', 'cursive'],
                        body: ['"Nunito"', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'bounce-slow': 'bounce 2s infinite',
                        'wiggle': 'wiggle 1s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        wiggle: {
                            '0%, 100%': { transform: 'rotate(-3deg)' },
                            '50%': { transform: 'rotate(3deg)' },
                        },
                        shake: {
                            '0%, 100%': { transform: 'translateX(0)' },
                            '25%': { transform: 'translateX(-5px)' },
                            '75%': { transform: 'translateX(5px)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background: linear-gradient(135deg, #fff0f3 0%, #ffc9d2 100%);
            overflow: hidden; /* Prevent scrolling during game */
            touch-action: none; /* Prevent zooming/scrolling on mobile */
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 20px 50px rgba(250, 62, 97, 0.2);
        }

        .btn-primary {
            background: linear-gradient(45deg, #fa3e61, #e61e45);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .btn-primary:active {
            transform: scale(0.95);
        }

        /* The Runaway Button */
        #noBtn {
            position: absolute; 
            z-index: 50;
            transition: top 0.3s ease, left 0.3s ease, transform 0.3s ease;
        }

        /* Shake animation for wrong answers */
        .shake-element {
            animation: shake 0.4s ease-in-out;
            border-color: #ef4444 !important; /* Red border */
            color: #ef4444 !important;
        }

        .heart-target {
            position: absolute;
            cursor: pointer;
            user-select: none;
            animation: float 2s infinite ease-in-out;
            transition: transform 0.1s;
        }
        .heart-target:active {
            transform: scale(1.5);
        }

        .progress-bar-fill {
            transition: width 0.5s ease-out;
        }

        /* Screen Transitions */
        .screen {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
            position: absolute;
            inset: 0;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            z-index: 10;
        }
        
        .screen.active {
            display: flex;
            opacity: 1;
        }
    </style>
</head>
<body class="min-h-screen font-body text-gray-800">

    <!-- Top Bar: Progress -->
    <div class="fixed top-0 left-0 w-full p-4 z-50">
        <div class="max-w-md mx-auto bg-white/50 backdrop-blur rounded-full p-1 border border-white/60 shadow-sm">
            <div class="flex items-center gap-3 px-2">
                <span class="text-xs font-bold text-love-600 uppercase tracking-wider">Love Meter</span>
                <div class="flex-1 h-3 bg-love-100 rounded-full overflow-hidden">
                    <div id="love-meter" class="progress-bar-fill h-full bg-gradient-to-r from-love-400 to-love-600 w-[0%] rounded-full shadow-[0_0_10px_rgba(250,62,97,0.5)]"></div>
                </div>
                <span id="level-indicator" class="text-xs font-bold text-love-600">0%</span>
            </div>
        </div>
    </div>

    <!-- STAGE 0: WELCOME -->
    <div id="screen-0" class="screen active">
        <div class="glass-panel p-8 rounded-3xl max-w-sm w-full text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-love-300 via-love-500 to-love-300"></div>
            
            <i data-lucide="lock" class="w-12 h-12 mx-auto text-love-500 mb-4 animate-bounce-slow"></i>
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Restricted Access</h1>
            <p class="text-gray-600 mb-8">This portal is securely locked. Only <span class="font-bold text-love-600">Maqbool</span> is authorized to enter.</p>
            
            <button onclick="startGame()" class="btn-primary w-full text-white font-bold py-4 rounded-xl shadow-lg text-lg flex items-center justify-center gap-2 group">
                I am Maqbool
                <i data-lucide="arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
            </button>
            <p class="mt-4 text-xs text-gray-400">Security Clearance: Level <span class="text-love-500">Husband</span></p>
        </div>
    </div>

    <!-- STAGE 1: CATCH HEARTS -->
    <div id="screen-1" class="screen">
        <div class="text-center z-20 pointer-events-none">
            <h2 class="text-4xl font-script text-love-600 mb-2 animate-pulse">Mission 1</h2>
            <p class="text-xl text-gray-700 font-bold bg-white/60 px-6 py-2 rounded-full inline-block backdrop-blur-sm shadow-sm">Catch 5 Floating Hearts!</p>
        </div>
        <!-- Hearts container fills the screen -->
        <div id="game-area" class="absolute inset-0 z-10 overflow-hidden"></div>
    </div>

    <!-- STAGE 2: THE QUIZ -->
    <div id="screen-2" class="screen">
        <div class="glass-panel p-6 rounded-3xl max-w-sm w-full text-center">
            <h2 class="text-2xl font-bold text-love-600 mb-6">Mission 2: The Truth Test</h2>
            <div id="quiz-container">
                <p id="quiz-q" class="text-lg font-bold text-gray-800 mb-6">Loading...</p>
                <div class="grid gap-3">
                    <button id="opt-1" onclick="handleQuiz(1)" class="bg-white hover:bg-love-50 border-2 border-love-100 text-love-600 font-bold py-3 rounded-xl transition-colors"></button>
                    <button id="opt-2" onclick="handleQuiz(2)" class="bg-white hover:bg-love-50 border-2 border-love-100 text-love-600 font-bold py-3 rounded-xl transition-colors"></button>
                </div>
            </div>
            <div id="quiz-feedback" class="hidden mt-4 font-bold text-lg animate-bounce"></div>
        </div>
    </div>

    <!-- STAGE 3: THE PROPOSAL (Runaway Button) -->
    <div id="screen-3" class="screen">
        <div class="glass-panel p-8 rounded-3xl max-w-lg w-full text-center relative z-20">
            <h2 class="text-2xl text-love-400 font-bold mb-1">Final Mission</h2>
            <h1 class="font-script text-6xl text-love-600 mb-6 leading-tight">Will you be my Valentine?</h1>
            
            <div class="h-48 relative flex items-center justify-center overflow-hidden rounded-xl bg-love-50/50">
                <!-- Wrapper for buttons to establish relative context -->
                <div class="relative w-full h-full">
                    <button onclick="finishGame()" class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10 bg-love-500 hover:bg-love-600 text-white font-bold py-4 px-12 rounded-full shadow-xl text-xl animate-wiggle border-4 border-white">
                        YES! ‚ù§Ô∏è
                    </button>
                    
                    <button id="noBtn" class="bg-gray-200 text-gray-500 font-bold py-2 px-6 rounded-full shadow-inner text-sm whitespace-nowrap animate-bounce-slow">
                        No
                    </button>
                </div>
            </div>
            <p class="text-xs text-gray-400 mt-4 opacity-50">Hint: You really have no choice.</p>
        </div>
    </div>

    <!-- STAGE 4: SUCCESS & REASONS -->
    <div id="screen-4" class="screen overflow-y-auto">
        <div class="glass-panel p-8 rounded-3xl max-w-md w-full text-center my-auto relative">
            
            <!-- Badge -->
            <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-yellow-400 text-yellow-900 text-xs font-bold px-4 py-1 rounded-full shadow-md uppercase tracking-wide">
                Mission Accomplished
            </div>

            <h1 class="font-script text-5xl text-love-600 mb-4 mt-2">I Knew It!</h1>
            
            <div class="bg-gradient-to-br from-love-50 to-white rounded-xl p-6 mb-6 shadow-inner border border-love-100">
                <p class="text-gray-700 leading-relaxed">
                    "Happy Valentine's Day, <strong>Maqbool</strong>! <br><br>
                    You are my home, my adventure, and my safe place. Thank you for playing my silly game. I love you more than code, coffee, or anything else in this world!"
                </p>
                <p class="font-script text-3xl text-love-500 mt-4 text-right">- Mehtab ‚ù§Ô∏è</p>
            </div>

            <hr class="border-love-200 mb-6">

            <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100 relative overflow-hidden group">
                <div class="absolute top-0 left-0 w-1 h-full bg-love-400"></div>
                <h3 class="text-sm font-bold text-gray-400 uppercase tracking-widest mb-2">Reason I Love You #<span id="reason-count">1</span></h3>
                <p id="reason-text" class="text-xl font-bold text-gray-800 min-h-[3rem] flex items-center justify-center">
                    Because you make me laugh even when I'm mad.
                </p>
                <div class="mt-4 flex justify-center">
                    <button onclick="nextReason()" class="bg-love-100 hover:bg-love-200 text-love-700 text-sm font-bold py-2 px-6 rounded-full transition-colors flex items-center gap-2">
                        Next Reason <i data-lucide="refresh-cw" class="w-3 h-3"></i>
                    </button>
                </div>
            </div>

        </div>
        <footer class="mt-8 text-love-800/60 text-xs font-medium">Capture a screenshot and send it to Mehtab!</footer>
    </div>

    <script>
        // --- State Management ---
        let currentLevel = 0;
        let loveMeter = 0;
        const screens = [
            document.getElementById('screen-0'),
            document.getElementById('screen-1'),
            document.getElementById('screen-2'),
            document.getElementById('screen-3'),
            document.getElementById('screen-4')
        ];
        const meterFill = document.getElementById('love-meter');
        const levelText = document.getElementById('level-indicator');

        // --- Icons ---
        lucide.createIcons();

        // --- Functions ---

        function updateProgress(percent) {
            loveMeter = percent;
            meterFill.style.width = `${percent}%`;
            levelText.innerText = `${percent}%`;
            
            if(percent >= 100 && currentLevel < 3) {
                confetti({ particleCount: 30, spread: 50, origin: { y: 0.2 } });
            }
        }

        function switchScreen(index) {
            screens[currentLevel].classList.remove('active');
            currentLevel = index;
            setTimeout(() => {
                screens[currentLevel].classList.add('active');
                
                if (index === 1) initHeartGame();
                if (index === 2) initQuiz();
                if (index === 3) initRunawayBtn();
                if (index === 4) startFinale();
            }, 500);
        }

        function startGame() {
            updateProgress(10);
            switchScreen(1);
        }

        // --- Level 1: Catch Hearts ---
        let heartsCaught = 0;
        const totalHeartsNeeded = 5;

        function initHeartGame() {
            const gameArea = document.getElementById('game-area');
            const interval = setInterval(() => {
                if (heartsCaught >= totalHeartsNeeded) {
                    clearInterval(interval);
                    gameArea.innerHTML = ''; 
                    updateProgress(35);
                    setTimeout(() => switchScreen(2), 1000);
                    return;
                }
                spawnHeart(gameArea);
            }, 800);
        }

        function spawnHeart(container) {
            const heart = document.createElement('div');
            heart.innerHTML = '‚ù§Ô∏è';
            heart.className = 'heart-target text-4xl absolute';
            
            const x = Math.random() * (window.innerWidth - 50);
            const y = Math.random() * (window.innerHeight - 100) + 50;
            heart.style.left = `${x}px`;
            heart.style.top = `${y}px`;
            
            heart.onclick = () => {
                heartsCaught++;
                heart.style.transform = 'scale(0) rotate(360deg)';
                heart.style.transition = 'all 0.5s';
                setTimeout(() => heart.remove(), 500);
                
                const percent = 10 + (heartsCaught / totalHeartsNeeded) * 25; 
                updateProgress(Math.floor(percent));
                
                confetti({
                    particleCount: 15,
                    spread: 30,
                    origin: { x: x/window.innerWidth, y: y/window.innerHeight }
                });
            };

            container.appendChild(heart);
            setTimeout(() => {
                if(heart.parentNode) {
                    heart.style.opacity = '0';
                    setTimeout(() => heart.remove(), 500);
                }
            }, 2000);
        }

        // --- Level 2: The Quiz (Strict Mode) ---
        const questions = [
            { 
                q: "Who is the boss in this relationship?", 
                a: ["Mehtab", "Maqbool"], 
                correct: 0,
                error: "Excuse me? Try again ü§®" 
            },
            { 
                q: "Who is more dramatic?", 
                a: ["Mehtab", "Maqbool"], 
                correct: 1, // Let's say he is dramatic! Or change to 0 if you prefer. Assuming Maqbool for fun.
                error: "Lies detected! ü§•"
            },
            { 
                q: "What is the best thing that happened to Maqbool?", 
                a: ["Meeting Mehtab", "Winning Lottery"], 
                correct: 0,
                error: "Money can't buy this love! üí∏‚ùå"
            }
        ];
        let quizIdx = 0;

        function initQuiz() {
            loadQuestion();
        }

        function loadQuestion() {
            const qObj = questions[quizIdx];
            document.getElementById('quiz-q').innerText = qObj.q;
            document.getElementById('opt-1').innerText = qObj.a[0];
            document.getElementById('opt-2').innerText = qObj.a[1];
            
            const feedback = document.getElementById('quiz-feedback');
            feedback.classList.add('hidden');
            feedback.innerText = "";
            feedback.classList.remove('text-green-500', 'text-red-500');
            
            // Remove shake classes
            document.getElementById('opt-1').classList.remove('shake-element');
            document.getElementById('opt-2').classList.remove('shake-element');
        }

        window.handleQuiz = (choiceIndex) => { 
            const currentQ = questions[quizIdx];
            const feedback = document.getElementById('quiz-feedback');
            const selectedIdx = choiceIndex - 1; // Convert 1-based to 0-based
            
            // STRICT CHECK: Matches correct index?
            if (selectedIdx === currentQ.correct) {
                // Correct
                feedback.innerText = "Correct! ‚ù§Ô∏è";
                feedback.classList.remove('hidden', 'text-red-500');
                feedback.classList.add('text-green-500');
                
                updateProgress(35 + ((quizIdx + 1) / questions.length) * 30);

                setTimeout(() => {
                    quizIdx++;
                    if (quizIdx < questions.length) {
                        loadQuestion();
                    } else {
                        switchScreen(3);
                    }
                }, 1000);
            } else {
                // Wrong
                const btn = document.getElementById(`opt-${choiceIndex}`);
                
                // Trigger reflow to restart animation if clicked twice
                btn.classList.remove('shake-element');
                void btn.offsetWidth; 
                btn.classList.add('shake-element');
                
                feedback.innerText = currentQ.error;
                feedback.classList.remove('hidden', 'text-green-500');
                feedback.classList.add('text-red-500');
            }
        };

        // --- Level 3: Runaway Button (Dancing Version) ---
        function initRunawayBtn() {
            const noBtn = document.getElementById('noBtn');
            const parent = noBtn.parentElement;
            
            const moveBtn = () => {
                const containerRect = parent.getBoundingClientRect();
                const btnRect = noBtn.getBoundingClientRect();
                
                const maxX = containerRect.width - btnRect.width;
                const maxY = containerRect.height - btnRect.height;
                
                let newX = Math.random() * maxX;
                let newY = Math.random() * maxY;
                
                // Add rotation for the "Dance/Jump" effect
                const randomRotate = Math.floor(Math.random() * 40) - 20; // -20 to 20deg

                noBtn.style.left = `${newX}px`;
                noBtn.style.top = `${newY}px`;
                noBtn.style.transform = `rotate(${randomRotate}deg)`;
            };

            noBtn.addEventListener('mouseenter', moveBtn);
            noBtn.addEventListener('touchstart', (e) => { e.preventDefault(); moveBtn(); });
            noBtn.addEventListener('click', (e) => { e.preventDefault(); moveBtn(); });
            
            // Move it initially so it doesn't overlap YES
            setTimeout(moveBtn, 500);
        }

        function finishGame() {
            updateProgress(100);
            switchScreen(4);
        }

        // --- Level 4: Finale & Reasons ---
        const reasons = [
            "You make the best tea (or at least you try!).",
            "Your smile lights up my entire bad day.",
            "You work so hard for us.",
            "You listen to my endless stories.",
            "You let me win arguments (sometimes).",
            "You are handsome inside and out.",
            "You support my dreams.",
            "You give the best hugs.",
            "You know exactly how to make me laugh.",
            "We make the perfect team.",
            "You are my best friend.",
            "Life is boring without you.",
            "You put up with my mood swings.",
            "You are simply YOU.",
            "I love the way you look at me.",
            "You are my safe space.",
            "We have the best inside jokes.",
            "You are a kind soul.",
            "Because I said so!",
            "You make me feel beautiful."
        ];
        
        let reasonIdx = 0;

        function startFinale() {
            const duration = 5000;
            const end = Date.now() + duration;

            (function frame() {
                confetti({
                    particleCount: 5,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 },
                    colors: ['#ff0000', '#ffa500']
                });
                confetti({
                    particleCount: 5,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 },
                    colors: ['#ff0000', '#ffa500']
                });

                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            }());
        }

        window.nextReason = () => {
            reasonIdx = (reasonIdx + 1) % reasons.length;
            const textEl = document.getElementById('reason-text');
            const countEl = document.getElementById('reason-count');
            
            textEl.style.opacity = 0;
            setTimeout(() => {
                textEl.innerText = reasons[reasonIdx];
                countEl.innerText = reasonIdx + 1;
                textEl.style.opacity = 1;
            }, 200);

            confetti({
                particleCount: 10,
                spread: 40,
                origin: { y: 0.8 },
                scalar: 0.7
            });
        };

    </script>
</body>
</html>